<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Litera Akses - Perpustakaan Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            /* remove */
            font-family: 'Inter', sans-serif; 
        }
        .hero-gradient {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
        }
        .book-card-synopsis {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.5;
        }
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.2s ease-out;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); }
            to { transform: translateX(100%); }
        }
        .slide-in-right {
            animation: slideInRight 0.3s ease-out;
        }
        .slide-out-right {
            animation: slideOutRight 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Navbar -->
    <header class="bg-white shadow-sm sticky top-0 z-50 border-b border-gray-100">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo & Brand -->
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg flex items-center justify-center shadow-md">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                    <h1 class="text-xl sm:text-2xl font-bold bg-gradient-to-r from-blue-700 to-blue-600 bg-clip-text text-transparent">
                        Litera Akses
                    </h1>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-4">
                    <a href="/" class="px-3 py-2 text-base font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                        Beranda
                    </a>
                    <a href="/listbook" class="px-4 py-2 text-base font-semibold bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all shadow-sm hover:shadow-md">
                        Daftar Buku
                    </a>
                </div>

                <!-- Hamburger Button (Mobile) -->
                <button id="hamburger-btn" class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>
        </nav>
    </header>

    <!-- Mobile Sidebar Menu -->
    <div id="mobile-menu-backdrop" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div id="mobile-menu" class="fixed top-0 right-0 bottom-0 w-64 bg-white shadow-2xl slide-in-right">
            <!-- Menu Header -->
            <div class="flex items-center justify-between p-4 border-b border-gray-200">
                <h2 class="text-lg font-bold text-gray-900">Menu</h2>
                <button id="close-menu-btn" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Menu Items -->
            <nav class="p-4 space-y-2">
                <a href="/" class="flex items-center space-x-3 px-4 py-3 text-blue-600 bg-blue-50 rounded-lg font-medium transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    <span>Beranda</span>
                </a>
                <a href="/listbook" class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-100 rounded-lg font-medium transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                    </svg>
                    <span>Daftar Buku</span>
                </a>
            </nav>

            <!-- Menu Footer -->
            <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 bg-gray-50">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-gray-900">Litera Akses</p>
                        <p class="text-xs text-gray-600">Perpustakaan Digital</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero-gradient text-white relative overflow-hidden">
        <div class="absolute inset-0 bg-black opacity-5"></div>
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-20 lg:py-24">
            <div class="text-center max-w-4xl mx-auto">
                <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 sm:mb-6 leading-tight">
                    Selamat Datang di<br class="sm:hidden"/> Litera Akses
                </h2>
                <p class="text-base sm:text-lg lg:text-xl opacity-95 mb-8 max-w-2xl mx-auto px-4">
                    Platform perpustakaan digital untuk siswa SMA. Jelajahi ribuan koleksi buku berkualitas dan kembangkan wawasan Anda.
                </p>
                <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center items-center">
                    <a href="#koleksi" class="w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-3.5 bg-white text-blue-700 font-semibold rounded-lg hover:bg-gray-50 transition-all shadow-lg hover:shadow-xl text-sm sm:text-base">
                        Mulai Jelajahi
                    </a>
                    <a href="/listbook" class="w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-3.5 bg-blue-700 text-white font-semibold rounded-lg hover:bg-blue-800 transition-all border-2 border-white/30 text-sm sm:text-base">
                        Lihat Semua Buku
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Wave Decoration -->
        <div class="absolute bottom-0 left-0 right-0">
            <svg viewBox="0 0 1440 120" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-12 sm:h-16">
                <path d="M0 120L60 110C120 100 240 80 360 70C480 60 600 60 720 65C840 70 960 80 1080 85C1200 90 1320 90 1380 90L1440 90V120H1380C1320 120 1200 120 1080 120C960 120 840 120 720 120C600 120 480 120 360 120C240 120 120 120 60 120H0V120Z" fill="#f9fafb"/>
            </svg>
        </div>
    </section>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 sm:py-12 lg:py-16" id="koleksi">
        <!-- Section Header -->
        <div class="mb-8 sm:mb-10 lg:mb-12">
            <div class="flex items-center space-x-3 mb-2">
                <div class="h-8 w-1 bg-blue-600 rounded-full"></div>
                <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900">
                    Koleksi Buku Populer
                </h2>
            </div>
            <p class="text-sm sm:text-base text-gray-600 ml-0 sm:ml-7 mt-2">
                Temukan buku favorit Anda dari berbagai kategori
            </p>
        </div>

        <!-- Book Grid -->
        <div id="book-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5 sm:gap-6 lg:gap-7">
            <!-- Loading State -->
            <div id="loading-skeleton" class="col-span-full">
                <div class="flex flex-col items-center justify-center py-16 sm:py-20">
                    <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4"></div>
                    <p class="text-gray-600 font-medium">Memuat koleksi buku...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Loan Modal -->
    <div id="loan-modal" class="fixed inset-0 bg-black/60 modal-backdrop flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg animate-fadeIn" id="modal-content">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-6 sm:px-8 py-5 rounded-t-2xl">
                <h3 class="text-xl sm:text-2xl font-bold text-white">Form Peminjaman Buku</h3>
            </div>
            
            <!-- Modal Body -->
            <div class="px-6 sm:px-8 py-6">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <p class="text-sm text-gray-700">
                        <span class="font-medium text-gray-600">Buku:</span>
                        <span id="modal-book-title" class="font-semibold text-gray-900 block mt-1"></span>
                    </p>
                </div>

                <form id="loan-form" class="space-y-5">
                    <input type="hidden" id="modal-book-id">
                    
                    <div>
                        <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">
                            Nama Lengkap <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="name" name="name" required 
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Masukkan nama lengkap">
                    </div>
                    
                    <div>
                        <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                            Alamat Email <span class="text-red-500">*</span>
                        </label>
                        <input type="email" id="email" name="email" required 
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="nama@email.com">
                    </div>
                    
                    <div>
                        <label for="className" class="block text-sm font-semibold text-gray-700 mb-2">
                            Kelas
                        </label>
                        <input type="text" id="className" name="className" 
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Contoh: XI IPA 1 (opsional)">
                    </div>
                    
                    <div>
                        <label for="duration" class="block text-sm font-semibold text-gray-700 mb-2">
                            Durasi Peminjaman <span class="text-red-500">*</span>
                        </label>
                        <select id="duration" name="duration" 
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white">
                            <option value="3">3 Hari</option>
                            <option value="5">5 Hari</option>
                            <option value="7">7 Hari</option>
                        </select>
                    </div>
                    
                    <div id="modal-message" class="text-sm font-medium rounded-lg p-3"></div>
                    
                    <div class="flex flex-col-reverse sm:flex-row gap-3 pt-2">
                        <button type="button" id="close-modal-btn" 
                            class="w-full sm:w-auto px-6 py-2.5 bg-gray-100 text-gray-700 font-semibold rounded-lg hover:bg-gray-200 transition-all border border-gray-300">
                            Batal
                        </button>
                        <button type="submit" id="submit-loan-btn" 
                            class="w-full sm:w-auto px-6 py-2.5 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-all shadow-md hover:shadow-lg disabled:bg-blue-300 disabled:cursor-not-allowed">
                            Ajukan Peminjaman
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const bookList = document.getElementById('book-list');
        const loadingSkeleton = document.getElementById('loading-skeleton');
        const loanModal = document.getElementById('loan-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const loanForm = document.getElementById('loan-form');
        const modalMessage = document.getElementById('modal-message');

        // Mobile Menu
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
        const mobileMenu = document.getElementById('mobile-menu');
        const closeMenuBtn = document.getElementById('close-menu-btn');

        function openMobileMenu() {
            mobileMenuBackdrop.classList.remove('hidden');
            mobileMenu.classList.remove('slide-out-right');
            mobileMenu.classList.add('slide-in-right');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileMenu() {
            mobileMenu.classList.remove('slide-in-right');
            mobileMenu.classList.add('slide-out-right');
            setTimeout(() => {
                mobileMenuBackdrop.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }, 300);
        }

        hamburgerBtn.addEventListener('click', openMobileMenu);
        closeMenuBtn.addEventListener('click', closeMobileMenu);
        mobileMenuBackdrop.addEventListener('click', (e) => {
            if (e.target === mobileMenuBackdrop) {
                closeMobileMenu();
            }
        });

        async function fetchBooks() {
            try {
                const response = await fetch('/api/books');
                const books = await response.json();

                loadingSkeleton.style.display = 'none';
                bookList.innerHTML = ''; 

                if (books.length === 0) {
                    bookList.innerHTML = `
                        <div class="col-span-full text-center py-16">
                            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                                </svg>
                            </div>
                            <p class="text-gray-500 font-medium">Belum ada buku yang tersedia</p>
                        </div>
                    `;
                    return;
                }

                books.forEach(book => {
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-xl shadow-md hover:shadow-xl overflow-hidden flex flex-col transition-all duration-300 hover:-translate-y-1 border border-gray-100';
                    const placeholderImage = 'https://via.placeholder.com/400x500.png/EBF4FF/3B82F6?text=Cover+Buku';
                    
                    card.innerHTML = `
                        <div class="relative overflow-hidden bg-gradient-to-br from-blue-50 to-blue-100">
                            <img src="${book.thumbnail_url || placeholderImage}" 
                                 alt="Cover ${book.title}" 
                                 class="w-full h-64 sm:h-72 object-cover hover:scale-105 transition-transform duration-300">
                        </div>
                        <div class="p-5 sm:p-6 flex flex-col flex-grow">
                            <h3 class="text-lg sm:text-xl font-bold text-gray-900 mb-2 line-clamp-2 leading-tight min-h-[3.5rem]">
                                ${book.title}
                            </h3>
                            <p class="text-gray-600 text-sm sm:text-base mb-4 flex-grow book-card-synopsis">
                                ${book.synopsis || 'Sinopsis tidak tersedia untuk buku ini.'}
                            </p>
                            <button data-book-id="${book.id}" 
                                    data-book-title="${book.title}" 
                                    class="open-modal-btn mt-auto w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 sm:py-3 rounded-lg transition-all shadow-sm hover:shadow-md active:scale-95">
                                Pinjam Buku
                            </button>
                        </div>
                    `;
                    bookList.appendChild(card);
                });
            } catch (error) {
                loadingSkeleton.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <div class="w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <p class="text-red-600 font-medium mb-2">Gagal memuat koleksi buku</p>
                        <p class="text-gray-500 text-sm">Silakan refresh halaman atau coba lagi nanti</p>
                    </div>
                `;
                console.error('Error fetching books:', error);
            }
        }

        function openModal(bookId, bookTitle) {
            document.getElementById('modal-book-id').value = bookId;
            document.getElementById('modal-book-title').textContent = bookTitle;
            loanModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            loanForm.reset();
            modalMessage.textContent = '';
            modalMessage.className = 'text-sm font-medium rounded-lg p-3';
            loanModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        bookList.addEventListener('click', (e) => {
            if (e.target.classList.contains('open-modal-btn')) {
                const bookId = e.target.dataset.bookId;
                const bookTitle = e.target.dataset.bookTitle;
                openModal(bookId, bookTitle);
            }
        });

        closeModalBtn.addEventListener('click', closeModal);
        loanModal.addEventListener('click', (e) => {
            if (e.target === loanModal) {
                closeModal();
            }
        });

        loanForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submit-loan-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Mengirim...';
            
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                className: document.getElementById('className').value,
                bookId: document.getElementById('modal-book-id').value,
                duration: document.getElementById('duration').value,
            };

            try {
                const response = await fetch('/api/loan-request', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                const result = await response.json();

                modalMessage.className = 'text-sm font-medium rounded-lg p-3';
                if (response.ok) {
                    modalMessage.textContent = result.message || 'Permintaan berhasil! Silakan cek email Anda untuk persetujuan.';
                    modalMessage.classList.add('bg-green-50', 'text-green-700', 'border', 'border-green-200');
                    setTimeout(closeModal, 2500);
                } else {
                    throw new Error(result.error || 'Terjadi kesalahan.');
                }
            } catch (error) {
                modalMessage.textContent = error.message;
                modalMessage.classList.add('bg-red-50', 'text-red-700', 'border', 'border-red-200');
            } finally {
                 submitBtn.disabled = false;
                 submitBtn.textContent = 'Ajukan Peminjaman';
            }
        });

        document.addEventListener('DOMContentLoaded', fetchBooks);
    </script>
          
</body>
</html>